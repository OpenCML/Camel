module fib

import { now } from time

func fib(idx: int): int sync {
    var cnt = 0
    func fibonacci(n: int): int sync {
        wait cnt += 1
        return if n <= 1 then n else fibonacci(n - 1) + fibonacci(n - 2)
    }
    let res = fibonacci(idx)
    println("Total calls made: {}".format(cnt))
    return res
}

export func main(): int sync {
    let idx = 25
    println("Start computing fibonacci({})...".format(idx))
    let start = now()
    let res = fib(idx)
    let duration = now() - start
    println("Fibonacci({}) = {} (computed in {} seconds)".format(idx, res, duration))
    return 0
}