module msort

import { now } from time
import { seed, rand, shuffle } from random
import { sort, merge_and_sort } from algo

func mergesort(a: int[]): int[] sync {
    if len(a) <= 10000 then sort(a) else {
        let mid = len(a) / 2
        let l = mergesort(a->slice<0, mid>)
        let r = mergesort(a->slice<mid, len(a)>)
        return merge_and_sort(l, r)
    }
}

func main(): int sync {
    let n = 100000
    let s = 7
    seed(s)
    'Generating {} values (seed={})...'->format<n, s>->println
    let arr = range(0, n)->shuffle

    'Start sorting {} numbers...'->format<n>->println
    let start = now()
    let sorted = mergesort(arr)
    let duration = now() - start

    'Sorted (first {} shown):'->format<n>->println
    // sorted
    //     ->slice<0, 10>
    //     ->map<(x: int): string => { return '{}'->format<x> }>
    //     ->join<' '>
    //     ->println

    'Mergesort completed in {} seconds'->format<duration>->println
    return 0
}